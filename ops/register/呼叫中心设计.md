# 呼叫中心

目标：让客服脱离智齿的客户端，直接使用 tehang-system，进行来电弹屏，主动呼出。

智齿接口文档：https://www.sobot.com/developer/

注：文档中的 TMC 应该是指现有的 TMC services + 未来的呼叫中心 service

## TMC 客服管理和同步智齿坐席

![](http://ww2.sinaimg.cn/large/006tNc79gy1g5bvbmargaj30rs099jrr.jpg)

TMC 需要把现有 StaffService 和智齿系统中的坐席进行合并，并且需要进行坐席状态的管理。

获取智齿 token : [获取访问 token 编码](https://www.sobot.com/developer/开放接口/呼叫中心/呼叫客服业务/呼叫中心外呼功能接口/获取访问token编码.html)

坐席登录 : [呼叫坐席登录](https://www.sobot.com/developer/开放接口/呼叫中心/呼叫客服业务/呼叫中心外呼功能接口/呼叫坐席登录.html)

设置坐席状态 : [呼叫坐席状态设置接口说明](https://www.sobot.com/developer/开放接口/呼叫中心/呼叫客服业务/呼叫中心外呼功能接口/呼叫坐席状态设置接口说明.html)

坐席登出 : [呼叫坐席登出接口说明](https://www.sobot.com/developer/开放接口/呼叫中心/呼叫客服业务/呼叫中心外呼功能接口/呼叫坐席登出接口说明.html)

需要考虑客服这边直接关闭浏览器的情况：WebSocket 断掉就代表着登出？

需要提供一个接口给智齿，以接收坐席状态变化的回调。

## 客户呼入

![](http://ww4.sinaimg.cn/large/006tNc79gy1g5bvco93l5j31fk0iaaao.jpg)

- 智齿接到客户电话后，会向 TMC 发起一条 Post 请求（[配置地址](https://www.sobot.com/console/settings/intelLigentRouting)），TMC 需要根据该请求做出处理，根据客户电话号码，以及相应的坐席状态，指定一个接听坐席（此时应该更新 TMC 的坐席状态）。详见[文档](https://www.sobot.com/developer/开放接口/呼叫中心/调用第三方CRM.html)

  - 智齿请求参数如下：

    ```
    secretKey：客户在智齿ivr流程页面配置的秘钥
    phoneNo：来电号码
    ```

* TMC 响应体如下：

* ```
  retCode：返回编码，000000（成功）或 999999（失败）
  retMsg： 返回消息，成功！或 失败！
  phoneNo：来电号码
  serviceEmail：客服邮箱账号(可以登录智齿呼叫中心的客服邮箱账号,可联系售后人员获取)
  ```

* TMC 同时还要推送一条消息到 WebSocket ，然后 WebSocket 推送客户电话到 TehangSystem
* 通话结束后，需要智齿推送坐席状态到 TMC， 以便于 TMC 更新坐席状态

## 客服呼出

![](http://ww2.sinaimg.cn/large/006tNc79gy1g5bvdfu84ij314s0qemy3.jpg)

智齿呼出功能的接口文档：[呼叫中心外呼功能接口](https://www.sobot.com/developer/开放接口/呼叫中心/呼叫客服业务/呼叫中心外呼功能接口/)
